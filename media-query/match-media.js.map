{"version":3,"file":"match-media.js","sourceRoot":"","sources":["match-media.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {OpaqueToken} from '@angular/core';\nimport {Injectable, NgZone} from '@angular/core';\n\nimport {BehaviorSubject} from 'rxjs/BehaviorSubject';\nimport {Observable} from 'rxjs/Observable';\n\n// RxJS Operators used by the classes...\nimport 'rxjs/add/operator/filter';\nimport 'rxjs/add/operator/map';\n\nimport {MediaChange} from './media-change';\n\n/**\n * EventHandler callback with the mediaQuery [range] activates or deactivates\n */\nexport interface MediaQueryListListener {\n  // Function with Window's MediaQueryList argument\n  (mql: MediaQueryList): void;\n}\n\n/**\n * EventDispatcher for a specific mediaQuery [range]\n */\nexport interface MediaQueryList {\n  readonly matches: boolean;\n  readonly media: string;\n  addListener(listener: MediaQueryListListener): void;\n  removeListener(listener: MediaQueryListListener): void;\n}\n\n/**\n *  Opaque Token unique to the flex-layout library.\n *  Note: Developers must use this token when building their own custom\n *  `MatchMediaObservableProvider` provider.\n *\n *  @see ./providers/match-media-observable-provider.ts\n */\n// tslint:disable-next-line:variable-name\nexport const MatchMediaObservable: OpaqueToken = new OpaqueToken('fxObservableMatchMedia');\n\n\n/**\n * MediaMonitor configures listeners to mediaQuery changes and publishes an Observable facade to\n * convert mediaQuery change callbacks to subscriber notifications. These notifications will be\n * performed within the ng Zone to trigger change detections and component updates.\n *\n * NOTE: both mediaQuery activations and de-activations are announced in notifications\n */\n\nexport class MatchMedia {\n  protected _registry: Map<string, MediaQueryList>;\n  protected _source: BehaviorSubject<MediaChange>;\n  protected _observable$: Observable<MediaChange>;\n\n  constructor(protected _zone: NgZone) {\n    this._registry = new Map<string, MediaQueryList>();\n    this._source = new BehaviorSubject<MediaChange>(new MediaChange(true));\n    this._observable$ = this._source.asObservable();\n  }\n\n  /**\n   * For the specified mediaQuery?\n   */\n  isActive(mediaQuery: string): boolean {\n    if (this._registry.has(mediaQuery)) {\n      let mql = this._registry.get(mediaQuery);\n      return mql.matches;\n    }\n    return false;\n  }\n\n  /**\n   * External observers can watch for all (or a specific) mql changes.\n   * Typically used by the MediaQueryAdaptor; optionally available to components\n   * who wish to use the MediaMonitor as mediaMonitor$ observable service.\n   *\n   * NOTE: if a mediaQuery is not specified, then ALL mediaQuery activations will\n   *       be announced.\n   */\n  observe(mediaQuery?: string): Observable<MediaChange> {\n    this.registerQuery(mediaQuery);\n\n    return this._observable$.filter((change: MediaChange) => {\n      return mediaQuery ? (change.mediaQuery === mediaQuery) : true;\n    });\n  }\n\n  /**\n   * Based on the BreakPointRegistry provider, register internal listeners for each unique\n   * mediaQuery. Each listener emits specific MediaChange data to observers\n   */\n  registerQuery(mediaQuery: string) {\n    if (mediaQuery) {\n      let mql = this._registry.get(mediaQuery);\n      let onMQLEvent = (e: MediaQueryList) => {\n        this._zone.run(() => {\n          let change = new MediaChange(e.matches, mediaQuery);\n          this._source.next(change);\n        });\n      };\n\n      if (!mql) {\n        mql = this._buildMQL(mediaQuery);\n        mql.addListener(onMQLEvent);\n        this._registry.set(mediaQuery, mql);\n      }\n\n      if (mql.matches) {\n        onMQLEvent(mql);  // Announce activate range for initial subscribers\n      }\n    }\n\n  }\n\n  /**\n   * Call window.matchMedia() to build a MediaQueryList; which\n   * supports 0..n listeners for activation/deactivation\n   */\n  protected  _buildMQL(query: string): MediaQueryList {\n    prepareQueryCSS(query);\n\n    let canListen = !!(<any>window).matchMedia('all').addListener;\n    return canListen ? (<any>window).matchMedia(query) : <MediaQueryList>{\n          matches: query === 'all' || query === '',\n          media: query,\n          addListener: () => {\n          },\n          removeListener: () => {\n          }\n        };\n  }\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: NgZone, },\n];\n}\n\n/**\n * Private global registry for all dynamically-created, injected style tags\n * @see prepare(query)\n */\nconst ALL_STYLES = {};\n\n/**\n * For Webkit engines that only trigger the MediaQueryListListener\n * when there is at least one CSS selector for the respective media query.\n *\n * @param query string The mediaQuery used to create a faux CSS selector\n *\n */\nfunction prepareQueryCSS(query) {\n  if (!ALL_STYLES[query]) {\n    try {\n      let style = document.createElement('style');\n\n      style.setAttribute('type', 'text/css');\n      if (!style['styleSheet']) {\n        let cssText = `@media ${query} {.fx-query-test{ }}`;\n        style.appendChild(document.createTextNode(cssText));\n      }\n\n      document.getElementsByTagName('head')[0].appendChild(style);\n\n      // Store in private global registry\n      ALL_STYLES[query] = style;\n\n    } catch (e) {\n      console.error(e);\n    }\n  }\n}\n\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}